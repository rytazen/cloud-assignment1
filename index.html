<!DOCTYPE html>
<html ng-app="myApp">
<head>
<link rel="stylesheet" href = "http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.0.4/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/0.8.0/angularfire.min.js"></script>
  
</head>

<body ng-controller="userController">
  <div class="container">

  <a href="">Click here</a> to open our application in another tab<br>
  <a href="">Click here</a> to watch our overview video.<br>
  <br>

  <!-- Show this div when the users is logged in -->
  <div ng-show="currentUser">
    You are logged in as: {{currentUser.github.displayName}} <br><br>
    <button class="btn btn-success" ng-click="editFeedback('new')">
      <span class="glyphicon"></span>Click here to give us a suggestion!
    </button>
    <button class="btn btn-success" ng-click="logout()">
      <span class="glyphicon"></span>Logout </button>
  </div>


  <!-- Show this div when the user is not logged in -->
  <div ng-hide="currentUser">
    <button class="btn btn-success" ng-click="login('github')">
      <span class="glyphicon glyphicon-user"></span>Login to submit idea!
    </button>
  </div>

  <div ng-show="edit">
    <h3 ng-show="edit">Idea Submission:</h3>

    <form class="form-horizontal">
      <!-- <div class="form-group">
        <label class="col-sm-2 control-label">UserID: </label>{{newuser.uid}}
      </div> -->
      <div class="form-group">
        <label class="col-sm-2 control-label">Name</label>
        <div class="col-sm-10">
          <input type="text" ng-model="newuser.name" ng-disabled="!edit" placeholder="Name">
        </div>
      </div> 
      <div class="form-group">
        <label class="col-sm-2 control-label">Email</label>
        <div class="col-sm-10">
          <input type="text" ng-model="newuser.email" ng-disabled="!edit" placeholder="e.g xxx@yyy.com">
        </div>
      </div> 
      <div class="form-group">
        <label class="col-sm-2 control-label">Category</label>
        <div class="col-sm-10">
          <input type="radio" ng-model="newuser.interests" ng-true-value="Children" name="interests[]" value="Children" />
            <label for="children">Children</label>
            <br />
            <input type="radio" ng-model="newuser.interests" ng-true-value="Elderly" name="interests[]" value="Elderly" />
            <label for="elderly">Elderly</label>
            <br />
            <input type="radio" ng-model="newuser.interests" ng-true-value="Education" name="interests[]" value="Education" />
            <label for="education">Education</label>
            <br />
            <input type="radio" ng-model="newuser.interests" ng-true-value="Cleaning" name="interests[]" value="Cleaning" />
            <label for="cleaning">Cleaning</label>
        </div>
        <br><br>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">Ideas</label>
          <div class="col-sm-10">
            <input type="text" ng-model="newuser.idea" cols="50" rows="10" ng-disabled="!edit" placeholder="e.g Train of Dreams, Thanksgiving for elderlys">
          </div>
      </div>
    </form>

    

    <button class="btn btn-success"  ng-click="save()">
      <span class="glyphicon glyphicon-save"></span>  Submit Idea
    </button>
  </div>

  <div ng-show="edit">
    <h3 ng-show="edit">Profile:</h3>

  <form class="form-horizontal">
      <!-- <div class="form-group">
        <label class="col-sm-2 control-label">UserID: </label>{{newuser.uid}}
      </div> -->
      <div class="form-group">
        <label class="col-sm-2 control-label">Name</label>
        <div class="col-sm-10">
          <input type="text" ng-model="newuser.name" ng-disabled="!edit" placeholder="Name">
        </div>
      </div> 
      <div class="form-group">
        <label class="col-sm-2 control-label">Email</label>
        <div class="col-sm-10">
          <input type="text" ng-model="newuser.email" ng-disabled="!edit" placeholder="e.g xxx@yyy.com">
        </div>
      </div> 
      <div class="form-group">
        <label class="col-sm-2 control-label">Password </label>
          <div class="col-sm-10">
            <input type="text" ng-model="newuser.password" cols="50" rows="10" ng-disabled="!edit" placeholder="*****">
          </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">Interest </label>
          <div class="col-sm-10">
            <input type="text" ng-model="newuser.interest" cols="50" rows="10" ng-disabled="!edit" placeholder="eg. Children/Education/Cleaning etc.">
          </div>
      </div>
    </form>
    <button class="btn btn-success"  ng-click="">
      <span class="glyphicon glyphicon-save"></span>  Update Profile
    </button>

</div>
  <hr>
    Please consider reviewing the applications of:
    <ul>
      <li>Check out (<a href="http://duyloc91.github.io/cloud-assignment-one/">Team 17</a>)</li>
      <li>Check out (<a href="http://is429-2016-nicholas.s3-website-ap-southeast-1.amazonaws.com/">Team 19</a>)</li>
    </ul>

  </div>
  <hr>
  <input type="checkbox" ng-model="hide_table" ng-init="hide_table=false"> Show submitted ideas.
  <table ng-show="hide_table" class="table table-striped">
    <thead>
      <tr>
        <th>Edit</th>
        <th>UID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Idea</th>
        <th>Interests</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="user in users">
        <td>
          <button class="btn" ng-click="editFeedback(user.$id)">
            <span class="glyphicon glyphicon-pencil"></span>  Edit
          </button>
        </td>
        <td>{{ user.uid }}</td>
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.idea }}</td>
        <td>{{ user.interests}}</td>
        <td>
          <button class="btn btn-danger" ng-click="deleteFeedback($index)">
            <span class="glyphicon glyphicon-pencil"></span>  Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <script>
    var myApp = angular.module("myApp", ["firebase"]);
    myApp.controller('userController', ['$scope', '$firebase',
      function($scope, $firebase) {
        $scope.newuser = {};
    
        // Here is where you update your Firebase URL. 
        var theFirebaseURL = "https://volunteerswitchboard.firebaseio.com/";
    
        var ref = new Firebase(theFirebaseURL);
        $scope.users = $firebase(ref.child("feedback")).$asArray(); 
        $scope.edit = false;
        $scope.error = false;
        $scope.incomplete = false;  
    
        $scope.currentUser = null;
        //Check to see if the users is already logged in to Firebase and update currentUser if yes. 
        var authData = ref.getAuth();
        if (authData && authData!={}) {
          $scope.currentUser = $firebase(ref.child("user").child(authData.uid)).$asObject();
        } else {
          console.log("User is logged out");
        }
    
        $scope.logout = function(loginProvider){
          $scope.currentUser = null;
        }
    
        $scope.login = function(loginProvider){
          ref.authWithOAuthPopup(loginProvider, function(error, authData) {
            if (error) {
              console.log("Login Failed!", error);
            } else {
              console.log("Authenticated successfully with payload:", authData);
              //Add the user to the users list. 
              ref.child("user/"+authData.uid).transaction(function(currentValue) {
                  return authData;
              });
              $scope.currentUser = $firebase(ref.child("user").child(authData.uid)).$asObject();    
              $scope.users = $firebase(ref.child("feedback")).$asArray();
            }
          });
        }
        
        $scope.editFeedback = function(id) {
          $scope.currentId = id;
          if (id == 'new') {
            $scope.edit = true;
            $scope.incomplete = true;
            $scope.newuser = {};
            console.log("new feedback.");
          } else {
            $scope.edit = true;
            $scope.newuser = $firebase(ref.child("feedback").child(id)).$asObject();
            console.log("existing feedback.");
          }
        };
    
        $scope.save = function(){
          //Add new if no index is passed in.
      
          if($scope.currentId=='new'){
            //Add the currentUser UID. 
            $scope.newuser.uid = $scope.currentUser.uid;
            $scope.users.$add($scope.newuser);
          } else{
            $scope.newuser.$save();
          }
          $scope.edit = false;
        };
    
      }]);
  </script>
  
  
  <!-- Google Tracking code. Change the UA-XXXXXXX key to be yours -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-72608302-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
